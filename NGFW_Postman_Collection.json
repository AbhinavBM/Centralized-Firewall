{
  "info": {
    "name": "NGFW System API Collection",
    "description": "Complete collection for NGFW endpoint communication following the proper flow",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    {
      "key": "endpoint_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "endpoint_password",
      "value": "Ritvik@1234",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Endpoint Authentication",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    if (response.status === 'success' && response.endpoint_id) {",
              "        pm.collectionVariables.set('endpoint_id', response.endpoint_id);",
              "        console.log('Endpoint ID saved:', response.endpoint_id);",
              "    }",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"endpoint_name\": \"RitvikBaby\",\n  \"password\": \"Ritvik@1234\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/endpoints/authenticate",
          "host": ["{{base_url}}"],
          "path": ["endpoints", "authenticate"]
        },
        "description": "Authenticate endpoint with centralized server"
      }
    },
    {
      "name": "2. Submit Applications",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"endpoint_id\": \"{{endpoint_id}}\",\n  \"applications\": {\n    \"chrome.exe\": {\n      \"description\": \"Web browser\",\n      \"status\": \"running\",\n      \"associated_ips\": [\n        {\n          \"source_ip\": \"192.168.1.14\",\n          \"destination_ip\": \"172.217.163.132\"\n        }\n      ],\n      \"source_ports\": [49775, 49776],\n      \"destination_ports\": [443]\n    },\n    \"msedgewebview2.exe\": {\n      \"description\": \"Edge WebView component\",\n      \"status\": \"running\",\n      \"associated_ips\": [\n        {\n          \"source_ip\": \"127.0.0.1\",\n          \"destination_ip\": \"127.0.0.1\"\n        }\n      ],\n      \"source_ports\": [59555],\n      \"destination_ports\": [59555]\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/endpoints/applications",
          "host": ["{{base_url}}"],
          "path": ["endpoints", "applications"]
        },
        "description": "Submit running applications and their network connections"
      }
    },
    {
      "name": "3. Fetch Firewall Rules",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-Endpoint-ID",
            "value": "{{endpoint_id}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/firewall/rules",
          "host": ["{{base_url}}"],
          "path": ["firewall", "rules"]
        },
        "description": "Fetch firewall rules for specific endpoint using headers"
      }
    },
    {
      "name": "4. Log Allowed Packet",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"type\": \"firewall\",\n  \"level\": \"info\",\n  \"message\": \"Packet allowed\",\n  \"details\": {\n    \"firewall_action\": \"allow\",\n    \"source_ip\": \"192.168.1.14\",\n    \"destination_ip\": \"172.217.163.132\",\n    \"source_port\": 49775,\n    \"destination_port\": 443,\n    \"protocol\": \"TCP\",\n    \"source_service\": \"Chrome\",\n    \"destination_service\": \"HTTPS\",\n    \"matched_rule\": {\n      \"action\": \"allow\",\n      \"service\": \"HTTPS\",\n      \"process_name\": \"chrome.exe\"\n    }\n  },\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"endpointId\": \"{{endpoint_id}}\",\n  \"applicationId\": \"507f1f77bcf86cd799439013\",\n  \"timestamp\": \"{{$isoTimestamp}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/logs",
          "host": ["{{base_url}}"],
          "path": ["logs"]
        },
        "description": "Log an allowed packet event"
      }
    },
    {
      "name": "5. Log Blocked Packet",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"type\": \"firewall\",\n  \"level\": \"warning\",\n  \"message\": \"Packet blocked\",\n  \"details\": {\n    \"firewall_action\": \"block\",\n    \"source_ip\": \"192.168.1.14\",\n    \"destination_ip\": \"104.18.37.186\",\n    \"source_port\": 49778,\n    \"destination_port\": 443,\n    \"protocol\": \"TCP\",\n    \"source_service\": \"Chrome\",\n    \"destination_service\": \"HTTPS\",\n    \"matched_rule\": {\n      \"action\": \"deny\",\n      \"service\": \"HTTPS\",\n      \"process_name\": \"chrome.exe\"\n    }\n  },\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"endpointId\": \"{{endpoint_id}}\",\n  \"applicationId\": \"507f1f77bcf86cd799439013\",\n  \"timestamp\": \"{{$isoTimestamp}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/logs",
          "host": ["{{base_url}}"],
          "path": ["logs"]
        },
        "description": "Log a blocked packet event"
      }
    },
    {
      "name": "6. Log Allowed Domain",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"type\": \"firewall\",\n  \"level\": \"info\",\n  \"message\": \"Domain allowed\",\n  \"details\": {\n    \"allowed_domain\": \"google.com\",\n    \"user_agent\": \"Chrome/91.0.4472.124\",\n    \"source_ip\": \"192.168.1.14\",\n    \"firewall_action\": \"allow\",\n    \"reason\": \"Domain in whitelist\"\n  },\n  \"userId\": \"507f1f77bcf86cd799439014\",\n  \"endpointId\": \"{{endpoint_id}}\",\n  \"applicationId\": \"507f1f77bcf86cd799439016\",\n  \"timestamp\": \"{{$isoTimestamp}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/logs",
          "host": ["{{base_url}}"],
          "path": ["logs"]
        },
        "description": "Log an allowed domain access"
      }
    },
    {
      "name": "7. Log Blocked Domain",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"type\": \"firewall\",\n  \"level\": \"warning\",\n  \"message\": \"Domain blocked\",\n  \"details\": {\n    \"blocked_domain\": \"facebook.com\",\n    \"user_agent\": \"Mozilla/5.0\",\n    \"source_ip\": \"192.168.1.14\",\n    \"firewall_action\": \"block\",\n    \"reason\": \"Domain not in whitelist\"\n  },\n  \"userId\": \"507f1f77bcf86cd799439011\",\n  \"endpointId\": \"{{endpoint_id}}\",\n  \"applicationId\": \"507f1f77bcf86cd799439013\",\n  \"timestamp\": \"{{$isoTimestamp}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/logs",
          "host": ["{{base_url}}"],
          "path": ["logs"]
        },
        "description": "Log a blocked domain access"
      }
    },
    {
      "name": "8. Batch Log Submission",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"logs\": [\n    {\n      \"type\": \"firewall\",\n      \"level\": \"info\",\n      \"message\": \"Packet allowed\",\n      \"details\": {\n        \"firewall_action\": \"allow\",\n        \"source_ip\": \"192.168.1.14\",\n        \"destination_ip\": \"172.217.163.132\",\n        \"source_port\": 49775,\n        \"destination_port\": 443,\n        \"protocol\": \"TCP\"\n      },\n      \"userId\": \"507f1f77bcf86cd799439011\",\n      \"endpointId\": \"{{endpoint_id}}\",\n      \"applicationId\": \"507f1f77bcf86cd799439013\",\n      \"timestamp\": \"{{$isoTimestamp}}\"\n    },\n    {\n      \"type\": \"firewall\",\n      \"level\": \"warning\",\n      \"message\": \"Domain blocked\",\n      \"details\": {\n        \"blocked_domain\": \"malicious-site.com\",\n        \"firewall_action\": \"block\",\n        \"reason\": \"Domain blacklisted\"\n      },\n      \"userId\": \"507f1f77bcf86cd799439011\",\n      \"endpointId\": \"{{endpoint_id}}\",\n      \"applicationId\": \"507f1f77bcf86cd799439013\",\n      \"timestamp\": \"{{$isoTimestamp}}\"\n    }\n  ]\n}"
        },
        "url": {
          "raw": "{{base_url}}/logs/batch",
          "host": ["{{base_url}}"],
          "path": ["logs", "batch"]
        },
        "description": "Submit multiple logs in a single request"
      }
    },
    {
      "name": "9. Get Log Statistics",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/logs/stats",
          "host": ["{{base_url}}"],
          "path": ["logs", "stats"]
        },
        "description": "Retrieve log statistics and analytics"
      }
    },
    {
      "name": "10. Create Firewall Rule (Admin)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token required for admin operations"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"endpointId\": \"{{endpoint_id}}\",\n  \"processName\": \"chrome.exe\",\n  \"entity_type\": \"ip\",\n  \"source_ip\": \"192.168.1.14\",\n  \"destination_ip\": \"104.18.37.186\",\n  \"source_port\": 49778,\n  \"destination_port\": 443,\n  \"action\": \"deny\",\n  \"priority\": 10,\n  \"description\": \"Block specific IP for Chrome\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/firewall/rules",
          "host": ["{{base_url}}"],
          "path": ["firewall", "rules"]
        },
        "description": "Create a new firewall rule for an endpoint (Admin only)"
      }
    },
    {
      "name": "11. Create Domain Rule (Admin)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token required for admin operations"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"endpointId\": \"{{endpoint_id}}\",\n  \"processName\": \"chrome.exe\",\n  \"entity_type\": \"domain\",\n  \"domain_name\": \"netflix.com\",\n  \"action\": \"allow\",\n  \"priority\": 5,\n  \"description\": \"Allow Netflix for Chrome\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/firewall/rules",
          "host": ["{{base_url}}"],
          "path": ["firewall", "rules"]
        },
        "description": "Create a domain-based firewall rule (Admin only)"
      }
    }
  ]
}
